<h1 class="mat-h1">Recipe</h1>
  <mat-card class="recipe-card">
    <mat-card-header>
      <mat-card-title>
        <h2 class="mat-h2">Overview</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content class="dashboard-card-content" *ngIf="backend.recipe; else noRecipeBlock">
      <mat-list>
        <mat-list-item>
          <p mat-line>{{backend.recipe.options.name}}</p>
          <p class="mat-form-field-label" mat-line>Name</p>
        </mat-list-item>
        <mat-list-item>
          <p mat-line>{{backend.recipe.options.version}}</p>
          <p class="mat-form-field-label" mat-line>Version</p>
        </mat-list-item>
        <mat-list-item>
          <p mat-line><span *ngFor="let module of backend.recipe.modules; let first=first"><span
            *ngIf="!first">, </span>{{module.module}}</span></p>
          <p class="mat-form-field-label" mat-line>Modules</p>
        </mat-list-item>
        <mat-list-item>
          <p mat-line>{{backend.recipe.status}}</p>
          <p mat-line class="mat-form-field-label">Status</p>
        </mat-list-item>
        <mat-list-item>
          <p mat-line>{{backend.recipe.currentStep.name}}</p>
          <p mat-line class="mat-form-field-label">Step</p>
        </mat-list-item>
      </mat-list>
    </mat-card-content>
    <mat-card-actions *ngIf="backend.recipe">
      <button [disabled]="!startAllowed()" (click)="start()" color="primary" mat-button><mat-icon>play_arrow</mat-icon>Start</button>
      <button [disabled]="!resetAllowed()" (click)="reset()" color="accent" mat-button><mat-icon>replay_arrow</mat-icon>Reset</button>
      <button [disabled]="!abortAllowed()" (click)="abort()" color="warn" mat-button>
        <mat-icon>clear</mat-icon>
        Abort all services
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card class="recipe-card">
    <mat-card-header>
      <mat-card-title>
        <h2 class="mat-h2">Steps</h2>
      </mat-card-title>
      <!--<mat-card-subtitle>Loaded from recipe</mat-card-subtitle>-->
    </mat-card-header>
    <mat-card-content>
    <mat-accordion *ngIf="backend.recipe; else noRecipeBlock">
      <mat-expansion-panel *ngFor="let step of backend.recipe.options.steps"
                           [class.active]="step.name == backend.recipe.currentStep.name">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <h3 class="mat-h3">{{step.name}} <span *ngIf="step.name == backend.recipe.options.initial_step"> (inital step)</span></h3>
          </mat-panel-title>
          <mat-panel-description >
            <span *ngIf="step.name == backend.recipe.currentStep.name">active</span>
          </mat-panel-description>
        </mat-expansion-panel-header>
        <h4 class="mat-h4">Operations</h4>
        <mat-list>
          <mat-list-item *ngFor="let operation of step.operations">
            {{operation.module}}.{{operation.service}}<span *ngIf="operation.strategy">.{{operation.strategy}}</span> ->
            {{operation.command}}
          </mat-list-item>
        </mat-list>
        <h4 class="mat-h4">Transitions</h4>
        <mat-list>
          <mat-list-item *ngFor="let transition of step.transitions">
            {{transition.next_step}}: {{transition.condition | json}}
          </mat-list-item>
        </mat-list>
      </mat-expansion-panel>
    </mat-accordion>
    </mat-card-content>
    <mat-card-actions>
      <button mat-button routerLink="/recipe/new">New/Edit Recipe</button>
    </mat-card-actions>
  </mat-card>

<!--
  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title>
        <h2 class="mat-h2">JSON</h2>
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field *ngIf="backend.recipe" class="example-container">
          <textarea matInput
                    placeholder="Current recipe options"
                    disabled
                    matTextareaAutosize
                    matAutosizeMinRows="5"
                    matAutosizeMaxRows="20"
                    [value]="backend.recipe.options | json"></textarea>
      </mat-form-field>

    </mat-card-content>
  </mat-card>
-->

<ng-template #noRecipeBlock>
  No recipe loaded yet
</ng-template>



